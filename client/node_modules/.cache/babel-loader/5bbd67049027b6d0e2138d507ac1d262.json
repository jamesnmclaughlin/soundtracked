{"ast":null,"code":"import _slicedToArray from \"/Users/jamesmclaughlin/Sites/soundtracked/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport React, { useEffect } from 'react';\n\n//  -- getServiceID() --\n// A function to retrieve the client ID from the backend node.js server.\n//\n// REQUIRES: \n//      service_name: A string parameter identifying the service e.g Strava, Fitbit... \n// \nfunction getServiceID(service_name) {\n  var _React$useState = React.useState(null),\n    _React$useState2 = _slicedToArray(_React$useState, 2),\n    data = _React$useState2[0],\n    setData = _React$useState2[1];\n  var options = {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify({\n      service_name: service_name\n    })\n  };\n  React.useEffect(function () {\n    fetch(\"/get-client\", options).then(function (res) {\n      return res.json();\n    }).then(function (data) {\n      return setData(data.key);\n    });\n  }, []);\n  return data;\n}\n\n//  -- checkForPreviousConnection() --\nfunction checkIfConnectionExists(service_name) {\n  var connection = false;\n  if (localStorage.getItem(service_name + '_access_token') !== null) {}\n}\n\n//  -- checkServiceConnection() --\n// A function to check the service connection of the specified service\n// if the application has lost connection then result returned is false.\n//\n// REQUIRES: \n//      service_name: A string parameter identifying the service e.g Strava, Fitbit... \n// \nfunction checkServiceConnection(service_name) {\n  var stillConnected = false;\n  if (localStorage.getItem(service_name + '_access_token') !== null) {\n    // LAST.FM does not provide an expiry date and therefore cannot expire\n    // IGNORE EXPIRY DATE\n    if (service_name !== \"lastfm\") {\n      if (localStorage.getItem(service_name + '_expiry_date') !== null) {\n        if (Date.parse(localStorage.getItem(service_name + '_expiry_date')) > Date.now()) {\n          stillConnected = true;\n        }\n      }\n    } else {\n      stillConnected = true;\n    }\n  }\n  return stillConnected;\n}\n\n//  -- reconnectService() --\n// A function to refresh the connection of the specified service if the \n// application has lost connection.\n//\n// REQUIRES: \n//      service_name: A string parameter identifying the service e.g Strava, Fitbit... \n// \nfunction reconnectService(service_name) {\n  var options = {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    body: JSON.stringify({\n      code_verify: localStorage.getItem(\"fitbitCV\"),\n      service_name: service_name,\n      refresh_token: localStorage.getItem(service_name + \"_refresh_token\")\n    })\n  };\n  useEffect(function () {\n    fetch(\"/refresh-session\", options).then(function (res) {\n      return res.json();\n    }).then(function (data) {\n      console.log(data);\n      if (data.hasOwnProperty('token')) {\n        localStorage.setItem(service_name + '_access_token', data.token);\n      }\n      if (data.hasOwnProperty('exp_date')) {\n        localStorage.setItem(service_name + '_expiry_date', data.exp_date);\n      }\n      if (data.hasOwnProperty('refresh_token')) {\n        localStorage.setItem(service_name + '_refresh_token', data.refresh_token);\n      }\n    });\n  }, []);\n  return true;\n}\nexport { checkServiceConnection, getServiceID, reconnectService };","map":{"version":3,"names":["React","useEffect","getServiceID","service_name","_React$useState","useState","_React$useState2","_slicedToArray","data","setData","options","method","headers","body","JSON","stringify","fetch","then","res","json","key","checkIfConnectionExists","connection","localStorage","getItem","checkServiceConnection","stillConnected","Date","parse","now","reconnectService","code_verify","refresh_token","console","log","hasOwnProperty","setItem","token","exp_date"],"sources":["/Users/jamesmclaughlin/Sites/soundtracked/client/src/components/functions/functions.js"],"sourcesContent":["import React, { useEffect } from 'react';\n\n\n//  -- getServiceID() --\n// A function to retrieve the client ID from the backend node.js server.\n//\n// REQUIRES: \n//      service_name: A string parameter identifying the service e.g Strava, Fitbit... \n// \nfunction getServiceID(service_name) {\n    const [data, setData] = React.useState(null);\n\n    const options = {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ service_name: service_name })\n    }\n\n    React.useEffect(() => {\n        fetch(\"/get-client\", options)\n          .then((res) => res.json())\n          .then((data) => setData(data.key));\n      }, []);\n\n    return data;\n}\n\n//  -- checkForPreviousConnection() --\nfunction checkIfConnectionExists(service_name) {\n    let connection = false;\n\n    if (localStorage.getItem(service_name + '_access_token') !== null) {}\n    \n}\n\n//  -- checkServiceConnection() --\n// A function to check the service connection of the specified service\n// if the application has lost connection then result returned is false.\n//\n// REQUIRES: \n//      service_name: A string parameter identifying the service e.g Strava, Fitbit... \n// \nfunction checkServiceConnection(service_name) {\n\n    let stillConnected = false;\n\n    if (localStorage.getItem(service_name + '_access_token') !== null) {\n\n        // LAST.FM does not provide an expiry date and therefore cannot expire\n        // IGNORE EXPIRY DATE\n        if (service_name !== \"lastfm\") {\n\n            if (localStorage.getItem(service_name + '_expiry_date') !== null) {\n                if (Date.parse(localStorage.getItem(service_name + '_expiry_date')) > Date.now()) {\n                    stillConnected = true;\n                }\n            }\n        }\n        else {\n            stillConnected = true\n        }\n    }\n    \n    return stillConnected;\n}\n\n//  -- reconnectService() --\n// A function to refresh the connection of the specified service if the \n// application has lost connection.\n//\n// REQUIRES: \n//      service_name: A string parameter identifying the service e.g Strava, Fitbit... \n// \nfunction reconnectService(service_name) {\n\n    const options = {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ \n            code_verify: localStorage.getItem(\"fitbitCV\"),\n            service_name: service_name,\n            refresh_token: localStorage.getItem(service_name + \"_refresh_token\")\n        })\n    }\n\n    useEffect(() => {\n        fetch(\"/refresh-session\", options)\n            .then((res) => res.json())\n            .then((data) => {\n                console.log(data);\n\n                if (data.hasOwnProperty('token')) {\n                    localStorage.setItem(service_name + '_access_token', data.token);\n                }\n                if (data.hasOwnProperty('exp_date')) {\n                    localStorage.setItem(service_name + '_expiry_date', data.exp_date);\n                }\n                if (data.hasOwnProperty('refresh_token')) {\n                    localStorage.setItem(service_name + '_refresh_token', data.refresh_token);\n                }\n            });\n      \n    }, []);\n\n    return true;\n\n}\n\nexport {checkServiceConnection, getServiceID, reconnectService };"],"mappings":"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"},"metadata":{},"sourceType":"module"}