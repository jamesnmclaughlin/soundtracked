{"ast":null,"code":"import _slicedToArray from \"/Users/jamesmclaughlin/Sites/soundtracked/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/jamesmclaughlin/Sites/soundtracked/client/src/components/pages/Test.js\";\nimport React, { useState, useEffect } from 'react';\nimport { checkServiceConnection, searchFunction, spotifySearch, audioFeatures, getStravaActivities, getStravaActivityInfo } from '../functions/functions';\nexport default function Test() {\n  var _useState = useState([]),\n    _useState2 = _slicedToArray(_useState, 2),\n    response = _useState2[0],\n    setResponse = _useState2[1]; //const [resultData, setResultData] = useState([]);\n  var _useState3 = useState(true),\n    _useState4 = _slicedToArray(_useState3, 2),\n    isLoading = _useState4[0],\n    setLoading = _useState4[1];\n  var trackInfo = null;\n  var fetchData = function fetchData() {\n    var resultJSON = [];\n    var hasHeartRateCounter = 0;\n    var average_distance = 0;\n    var average_heartrate = 0;\n    var average_elevation_change = 0;\n    var average_speed = 0;\n    getStravaActivities().then(function (stravaActivities) {\n      console.log(stravaActivities);\n      stravaActivities.forEach(function (activity) {\n        // Ignore Activity If Not a Run\n        if (activity.type == \"Run\") {\n          console.log(activity);\n          var resultData = [];\n\n          // Get Heartrate data from activity if it exists\n          if (activity.has_heartrate) {\n            hasHeartRateCounter += 1;\n            average_heartrate += activity.average_heartrate;\n          }\n          average_distance += activity.distance;\n          average_elevation_change += Math.abs(activity.elev_high - activity.elev_low);\n          average_speed += activity.average_speed;\n\n          // Convert Activity's Local Start Time to Unix Timestamp (seconds)\n          var start_date = Math.floor(new Date(activity.start_date).getTime() / 1000);\n          var end_date = null;\n\n          // Get extra activity information such as split metrics\n          getStravaActivityInfo(activity.id, function (activityStream) {\n            var sampling_rate = 100;\n\n            // grab current value\n            // check if there are 100 values ahead\n            // if no grab end value if not already current\n            // if yes grab value 100 ahead\n            // work difference between values\n            var _loop = function _loop() {\n              var start_time = activityStream.time.data[i];\n              var start_distance = activityStream.distance.data[i];\n              var end_time = null;\n              var end_distance = null;\n              if (activityStream.distance.original_size > i + 100) {\n                end_time = activityStream.time.data[i + 100];\n                end_distance = activityStream.distance.data[i + 100];\n              } else {\n                end_time = activityStream.time.data[activityStream.distance.original_size - 1];\n                end_distance = activityStream.distance.data[activityStream.distance.original_size - 1];\n              }\n              var time_diff = end_time - start_time;\n              var distance_diff = end_distance - start_distance;\n\n              // Determine Average Pace Metric (s/m)\n              var pace = time_diff / distance_diff;\n\n              // Check if metric has a adjusted elevation metric \n\n              // Find Songs Listened to between each split time\n\n              // After finding the songs listened to build an object with the metric pace and song features\n\n              end_date = start_date + time_diff;\n              if (checkServiceConnection(\"lastfm\")) {\n                fetch(\"/get-lastfm-songs?start_date=\" + start_date + \"&end_date=\" + end_date + \"&user=\" + localStorage.getItem(\"lastfm_name\")).then(function (res) {\n                  return res.json();\n                }).then(function (data) {\n                  setResponse(data.response.recenttracks.track);\n                  if (data.response.recenttracks.track.length > 0) {\n                    searchFunction(pace, data.response.recenttracks.track).then(function (trackList) {\n                      resultData = resultData.concat(trackList);\n                      console.log(resultData);\n                    });\n                  }\n                  setLoading(false);\n                });\n              }\n              //console.log(\"Start Date: \" + start_date)\n              //console.log(\"End Date: \" + end_date)\n\n              start_date = end_date + 1;\n            };\n            for (var i = 0; i < activityStream.distance.original_size - 1; i += sampling_rate) {\n              _loop();\n            }\n          }).then(function () {\n            resultJSON.push({\n              id: activity.id,\n              name: activity.name,\n              start_date: activity.start_date,\n              distance: activity.distance,\n              elapsed_time: activity.elapsed_time,\n              visibility: activity.visibility,\n              activity_metrics: resultData\n            });\n          });\n        }\n      });\n      console.log(resultJSON);\n      average_distance = average_distance / stravaActivities.length;\n      average_elevation_change = average_elevation_change / stravaActivities.length;\n      average_heartrate = average_heartrate / hasHeartRateCounter;\n      average_speed = average_speed / stravaActivities.length;\n      console.log(\"Average Distance: \" + average_distance);\n      console.log(\"Average Elevation Change: \" + average_elevation_change);\n      console.log(\"Average Heart Rate: \" + average_heartrate);\n      console.log(\"Average Speed: \" + average_speed);\n    });\n  };\n  useEffect(function () {\n    fetchData();\n  }, []);\n  if (isLoading) {\n    return \"Loading\";\n  }\n\n  /*audioFeatures(seedList, function(trackInfo) {\n      console.log(trackInfo);\n  }); */\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"p\", {\n    style: {\n      color: '#000'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 13\n    }\n  }, \"Loaded\"));\n}","map":{"version":3,"names":["React","useState","useEffect","checkServiceConnection","searchFunction","spotifySearch","audioFeatures","getStravaActivities","getStravaActivityInfo","Test","_useState","_useState2","_slicedToArray","response","setResponse","_useState3","_useState4","isLoading","setLoading","trackInfo","fetchData","resultJSON","hasHeartRateCounter","average_distance","average_heartrate","average_elevation_change","average_speed","then","stravaActivities","console","log","forEach","activity","type","resultData","has_heartrate","distance","Math","abs","elev_high","elev_low","start_date","floor","Date","getTime","end_date","id","activityStream","sampling_rate","_loop","start_time","time","data","i","start_distance","end_time","end_distance","original_size","time_diff","distance_diff","pace","fetch","localStorage","getItem","res","json","recenttracks","track","length","trackList","concat","push","name","elapsed_time","visibility","activity_metrics","createElement","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","style","color"],"sources":["/Users/jamesmclaughlin/Sites/soundtracked/client/src/components/pages/Test.js"],"sourcesContent":["import React, {useState, useEffect} from 'react';\nimport { checkServiceConnection, searchFunction, spotifySearch, audioFeatures, getStravaActivities, getStravaActivityInfo } from '../functions/functions';\n\nexport default function Test() {\n    \n    const [response, setResponse] = useState([]);\n    //const [resultData, setResultData] = useState([]);\n    const [isLoading, setLoading] = useState(true)\n    let trackInfo = null;\n\n    const fetchData = () => {\n\n        let resultJSON = [];\n        let hasHeartRateCounter = 0;\n        let average_distance = 0;\n        let average_heartrate = 0;\n        let average_elevation_change = 0;\n        let average_speed = 0;\n\n        getStravaActivities().then((stravaActivities) => {\n            console.log(stravaActivities)\n\n            stravaActivities.forEach(function(activity) {\n\n                // Ignore Activity If Not a Run\n                if (activity.type == \"Run\") {\n\n                    console.log(activity)\n                    let resultData = [];\n                    \n                    // Get Heartrate data from activity if it exists\n                    if (activity.has_heartrate) {\n                        hasHeartRateCounter += 1;\n                        average_heartrate += activity.average_heartrate;\n                    }\n\n                    average_distance += activity.distance;\n                    average_elevation_change += Math.abs(activity.elev_high - activity.elev_low);\n                    average_speed += activity.average_speed;\n\n                    // Convert Activity's Local Start Time to Unix Timestamp (seconds)\n                    let start_date = Math.floor(new Date(activity.start_date).getTime() / 1000);\n                    let end_date = null;\n\n                    // Get extra activity information such as split metrics\n                    getStravaActivityInfo(activity.id, function(activityStream) {\n\n                        let sampling_rate = 100;\n\n                        // grab current value\n                        // check if there are 100 values ahead\n                        // if no grab end value if not already current\n                        // if yes grab value 100 ahead\n                        // work difference between values\n                        for (let i = 0; i < (activityStream.distance.original_size - 1); i += sampling_rate) {\n\n                            let start_time = activityStream.time.data[i];\n                            let start_distance = activityStream.distance.data[i];\n                            let end_time = null;\n                            let end_distance = null;\n\n                            if (activityStream.distance.original_size > (i + 100) ) {\n                                end_time = activityStream.time.data[i+100];\n                                end_distance = activityStream.distance.data[i+100];\n                            } else {\n                                end_time = activityStream.time.data[activityStream.distance.original_size-1];\n                                end_distance = activityStream.distance.data[activityStream.distance.original_size-1];\n                            }\n\n                            let time_diff = end_time - start_time;\n                            let distance_diff = end_distance - start_distance;\n\n                            // Determine Average Pace Metric (s/m)\n                            let pace = time_diff / distance_diff;\n\n                            // Check if metric has a adjusted elevation metric \n\n                            // Find Songs Listened to between each split time\n\n                            // After finding the songs listened to build an object with the metric pace and song features\n\n\n                            end_date = start_date + time_diff;\n\n                            \n                            if (checkServiceConnection(\"lastfm\")) {\n                                fetch(\"/get-lastfm-songs?start_date=\" + start_date + \"&end_date=\" + end_date + \"&user=\" + localStorage.getItem(\"lastfm_name\"))\n                                    .then(res => res.json())\n                                    .then((data) => {\n                                        setResponse(data.response.recenttracks.track);\n\n                                        if (data.response.recenttracks.track.length > 0) {\n                                            \n                                            searchFunction(pace, data.response.recenttracks.track).then((trackList) => {\n                                                resultData = resultData.concat(trackList);\n                                                console.log(resultData)\n                                            });\n                                        }\n                    \n                                        setLoading(false);\n                                    });\n                            }\n                            //console.log(\"Start Date: \" + start_date)\n                            //console.log(\"End Date: \" + end_date)\n                            \n                            start_date = end_date + 1;\n                        }\n                    }).then(() => {\n                        resultJSON.push({\n                            id: activity.id,\n                            name: activity.name,\n                            start_date: activity.start_date,\n                            distance: activity.distance,\n                            elapsed_time: activity.elapsed_time,\n                            visibility: activity.visibility,\n                            activity_metrics: resultData\n                        });\n                    });\n                }\n            })\n            \n            console.log(resultJSON);\n\n            average_distance = average_distance / stravaActivities.length;\n            average_elevation_change = average_elevation_change / stravaActivities.length;\n            average_heartrate = average_heartrate / hasHeartRateCounter; \n            average_speed = average_speed / stravaActivities.length;\n\n            console.log(\"Average Distance: \" + average_distance);\n            console.log(\"Average Elevation Change: \" + average_elevation_change);\n            console.log(\"Average Heart Rate: \" + average_heartrate);\n            console.log(\"Average Speed: \" + average_speed); \n        });\n    }\n\n    useEffect(() => {\n        fetchData();\n    }, []);\n\n    if (isLoading) {\n        return \"Loading\";\n    }\n\n    /*audioFeatures(seedList, function(trackInfo) {\n        console.log(trackInfo);\n    }); */   \n\n    return (\n        <div>\n            <p style={{color: '#000'}}>Loaded</p>\n        </div>\n    )\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}