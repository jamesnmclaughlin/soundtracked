{"ast":null,"code":"var _jsxFileName = \"/Users/jamesmclaughlin/Sites/soundtracked/client/src/components/service.js\";\nimport React from 'react';\nimport { Link } from 'react-router-dom';\nimport getServiceID from './functions/functions';\nvar crypto = require('crypto');\nvar hex2dec = require('hex2dec');\nvar base64url = require('base64url');\nexport default function Service(props) {\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"service\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 11,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"service-img \" + props.api,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 12,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"service-type \" + props.type,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 13,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(\"a\", {\n    className: \"service-connect\",\n    href: connectURL(props.api),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 14,\n      columnNumber: 13\n    }\n  }, \"Connect\"));\n}\nfunction connectURL(apiService) {\n  var url = null;\n  var response_type = \"code\";\n  var scope = null;\n  var approval_prompt = \"force\";\n  var redirectURL = \"http://localhost:3000/\" + apiService;\n  var code_challenge = null;\n  var apiIdentifier = getServiceID(apiService);\n  switch (apiService) {\n    case \"strava\":\n      scope = \"read,activity:read\";\n      url = \"https://www.strava.com/oauth/authorize?\";\n      url = url + \"client_id=\" + apiIdentifier + \"&response_type=\" + response_type + \"&redirect_uri=\" + redirectURL + \"&approval_prompt=\" + approval_prompt + \"&scope=\" + scope;\n      break;\n    case \"fitbit\":\n      code_challenge = base64url.fromBase64(crypto.createHash('sha256').update(generateCodeVerifier()).digest('base64'));\n      scope = \"activity,heartrate\";\n      url = \"https://www.fitbit.com/oauth2/authorize?\";\n      url = url + \"client_id=\" + apiIdentifier + \"&code_challenge=\" + code_challenge + \"&code_challenge_method=S256&response_type=\" + response_type + \"&scope=activity+heartrate\";\n      break;\n    case \"lastfm\":\n      url = \"http://www.last.fm/api/auth?\";\n      url = url + \"api_key=\" + apiIdentifier + \"&cb=\" + redirectURL;\n      break;\n    case \"deezer\":\n      url = \"https://connect.deezer.com/oauth/auth.php?\";\n      url = url + \"app_id=\" + apiIdentifier + \"&redirect_uri=\" + redirectURL + \"&perms=basic_access,listening_history\";\n      break;\n  }\n  return url;\n}\nfunction generateCodeVerifier() {\n  // Clearing previous code verifier\n  localStorage.removeItem('fitbitCV');\n  var code = \"\";\n  while (code.length < 43 || code.length > 128) {\n    code = hex2dec.hexToDec(crypto.randomBytes(32).toString('hex')).toString();\n  }\n  console.log(code);\n  localStorage.setItem('fitbitCV', code);\n  return code;\n}","map":{"version":3,"names":["React","Link","getServiceID","crypto","require","hex2dec","base64url","Service","props","createElement","className","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","api","type","href","connectURL","apiService","url","response_type","scope","approval_prompt","redirectURL","code_challenge","apiIdentifier","fromBase64","createHash","update","generateCodeVerifier","digest","localStorage","removeItem","code","length","hexToDec","randomBytes","toString","console","log","setItem"],"sources":["/Users/jamesmclaughlin/Sites/soundtracked/client/src/components/service.js"],"sourcesContent":["import React from 'react';\nimport { Link } from 'react-router-dom';\nimport getServiceID from './functions/functions';\n\nconst crypto = require('crypto');\nconst hex2dec = require('hex2dec');\nconst base64url = require('base64url');\n\nexport default function Service(props) {\n    return (\n        <div className=\"service\">\n            <div className={\"service-img \" + props.api}></div>\n            <div className={\"service-type \" + props.type}></div>\n            <a className=\"service-connect\" href={connectURL(props.api)}>Connect</a>\n        </div>\n    );\n}\n\nfunction connectURL(apiService) {\n    let url = null;\n    let response_type = \"code\";\n    let scope = null;\n    let approval_prompt = \"force\";\n    let redirectURL = \"http://localhost:3000/\" + apiService;\n    let code_challenge = null;\n    let apiIdentifier = getServiceID(apiService);\n\n    switch(apiService) {\n        case \"strava\":\n            \n            scope = \"read,activity:read\";\n            url = \"https://www.strava.com/oauth/authorize?\";\n            url = url + \"client_id=\" + apiIdentifier + \"&response_type=\" + response_type + \"&redirect_uri=\" + redirectURL + \"&approval_prompt=\" + approval_prompt + \"&scope=\" + scope;\n            break;\n        case \"fitbit\": \n            \n            code_challenge = base64url.fromBase64(crypto.createHash('sha256').update(generateCodeVerifier()).digest('base64'));\n\n            scope = \"activity,heartrate\";\n            url = \"https://www.fitbit.com/oauth2/authorize?\";\n            url = url + \"client_id=\" + apiIdentifier + \"&code_challenge=\" + code_challenge + \"&code_challenge_method=S256&response_type=\" + response_type + \"&scope=activity+heartrate\" ;\n            break;\n        case \"lastfm\":\n            url = \"http://www.last.fm/api/auth?\";\n            url = url + \"api_key=\" + apiIdentifier + \"&cb=\" + redirectURL;\n            break;\n        case \"deezer\": \n            url = \"https://connect.deezer.com/oauth/auth.php?\";\n            url = url + \"app_id=\" + apiIdentifier + \"&redirect_uri=\" + redirectURL + \"&perms=basic_access,listening_history\"\n            break;\n    }\n\n    return url;\n}\n\nfunction generateCodeVerifier() {\n    // Clearing previous code verifier\n    localStorage.removeItem('fitbitCV');\n    let code = \"\";\n    \n    while (code.length < 43 || code.length > 128) {\n        code = hex2dec.hexToDec((crypto.randomBytes(32)).toString('hex')).toString();\n    }\n    console.log(code)\n    localStorage.setItem('fitbitCV', code);\n\n    return code;\n}"],"mappings":";AAAA,OAAOA,KAAK,MAAM,OAAO;AACzB,SAASC,IAAI,QAAQ,kBAAkB;AACvC,OAAOC,YAAY,MAAM,uBAAuB;AAEhD,IAAMC,MAAM,GAAGC,OAAO,CAAC,QAAQ,CAAC;AAChC,IAAMC,OAAO,GAAGD,OAAO,CAAC,SAAS,CAAC;AAClC,IAAME,SAAS,GAAGF,OAAO,CAAC,WAAW,CAAC;AAEtC,eAAe,SAASG,OAAOA,CAACC,KAAK,EAAE;EACnC,oBACIR,KAAA,CAAAS,aAAA;IAAKC,SAAS,EAAC,SAAS;IAAAC,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,gBACpBhB,KAAA,CAAAS,aAAA;IAAKC,SAAS,EAAE,cAAc,GAAGF,KAAK,CAACS,GAAI;IAAAN,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,EAAO,eAClDhB,KAAA,CAAAS,aAAA;IAAKC,SAAS,EAAE,eAAe,GAAGF,KAAK,CAACU,IAAK;IAAAP,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,EAAO,eACpDhB,KAAA,CAAAS,aAAA;IAAGC,SAAS,EAAC,iBAAiB;IAACS,IAAI,EAAEC,UAAU,CAACZ,KAAK,CAACS,GAAG,CAAE;IAAAN,MAAA;IAAAC,QAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA;EAAA,GAAC,SAAO,CAAI,CACrE;AAEd;AAEA,SAASI,UAAUA,CAACC,UAAU,EAAE;EAC5B,IAAIC,GAAG,GAAG,IAAI;EACd,IAAIC,aAAa,GAAG,MAAM;EAC1B,IAAIC,KAAK,GAAG,IAAI;EAChB,IAAIC,eAAe,GAAG,OAAO;EAC7B,IAAIC,WAAW,GAAG,wBAAwB,GAAGL,UAAU;EACvD,IAAIM,cAAc,GAAG,IAAI;EACzB,IAAIC,aAAa,GAAG1B,YAAY,CAACmB,UAAU,CAAC;EAE5C,QAAOA,UAAU;IACb,KAAK,QAAQ;MAETG,KAAK,GAAG,oBAAoB;MAC5BF,GAAG,GAAG,yCAAyC;MAC/CA,GAAG,GAAGA,GAAG,GAAG,YAAY,GAAGM,aAAa,GAAG,iBAAiB,GAAGL,aAAa,GAAG,gBAAgB,GAAGG,WAAW,GAAG,mBAAmB,GAAGD,eAAe,GAAG,SAAS,GAAGD,KAAK;MACzK;IACJ,KAAK,QAAQ;MAETG,cAAc,GAAGrB,SAAS,CAACuB,UAAU,CAAC1B,MAAM,CAAC2B,UAAU,CAAC,QAAQ,CAAC,CAACC,MAAM,CAACC,oBAAoB,EAAE,CAAC,CAACC,MAAM,CAAC,QAAQ,CAAC,CAAC;MAElHT,KAAK,GAAG,oBAAoB;MAC5BF,GAAG,GAAG,0CAA0C;MAChDA,GAAG,GAAGA,GAAG,GAAG,YAAY,GAAGM,aAAa,GAAG,kBAAkB,GAAGD,cAAc,GAAG,4CAA4C,GAAGJ,aAAa,GAAG,2BAA2B;MAC3K;IACJ,KAAK,QAAQ;MACTD,GAAG,GAAG,8BAA8B;MACpCA,GAAG,GAAGA,GAAG,GAAG,UAAU,GAAGM,aAAa,GAAG,MAAM,GAAGF,WAAW;MAC7D;IACJ,KAAK,QAAQ;MACTJ,GAAG,GAAG,4CAA4C;MAClDA,GAAG,GAAGA,GAAG,GAAG,SAAS,GAAGM,aAAa,GAAG,gBAAgB,GAAGF,WAAW,GAAG,uCAAuC;MAChH;EAAM;EAGd,OAAOJ,GAAG;AACd;AAEA,SAASU,oBAAoBA,CAAA,EAAG;EAC5B;EACAE,YAAY,CAACC,UAAU,CAAC,UAAU,CAAC;EACnC,IAAIC,IAAI,GAAG,EAAE;EAEb,OAAOA,IAAI,CAACC,MAAM,GAAG,EAAE,IAAID,IAAI,CAACC,MAAM,GAAG,GAAG,EAAE;IAC1CD,IAAI,GAAG/B,OAAO,CAACiC,QAAQ,CAAEnC,MAAM,CAACoC,WAAW,CAAC,EAAE,CAAC,CAAEC,QAAQ,CAAC,KAAK,CAAC,CAAC,CAACA,QAAQ,EAAE;EAChF;EACAC,OAAO,CAACC,GAAG,CAACN,IAAI,CAAC;EACjBF,YAAY,CAACS,OAAO,CAAC,UAAU,EAAEP,IAAI,CAAC;EAEtC,OAAOA,IAAI;AACf"},"metadata":{},"sourceType":"module"}